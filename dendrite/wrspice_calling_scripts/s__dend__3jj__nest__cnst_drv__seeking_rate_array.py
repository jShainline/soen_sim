import numpy as np
import time

from _util import physical_constants
p = physical_constants()

import WRSpice

#%%

# tempCirFile only netlist
# export your netlist to a cir file using 'deck' command in xic
# open the cir file and remove all lines except the netlist lines
# replace all values by Params, you want to sweep, with white space around
# Component names don't need any changes
# VERY IMPORTTANT Leave a blank line in the start and end of the  cir file

#%%
# dendritic series bias current
Ib = 85 # uA

# inductor in plasticity loop
Lp = 35 # pH

# dendritic plasticity bias current
Mp = np.sqrt(200*Lp)

# excitatory flux input

num_steps = 100 # 25 # for excitatory flux

max_flux = p['Phi0__pH_ns']/2
_fr = max_flux/num_steps # flux_resolution
_fr_0 = max_flux/200 # flux_resolution of first onset point

Mex = np.sqrt(400*12.5)
Iex_max = max_flux/Mex

# plasticity flux biases
Phi_p_list = [-1033.916875,-982.221031,-930.525188,-878.829344,-827.133500,-775.437656,-723.741813,-672.045969,-620.350125,-568.654281,-516.958438,-465.262594,-413.566750,-361.870906,-310.175063,-258.479219,-206.783375,-155.087531,-103.391688,-51.695844,0.000000,51.695844,103.391688,155.087531,206.783375,258.479219,310.175063,361.870906,413.566750,465.262594,516.958438,568.654281,620.350125,672.045969,723.741813,775.437656,827.133500,878.829344,930.525188,982.221031,1033.916875]

# excitatory flux 
Phi_ex_on_list = [779.780125,850.603432,909.536695,947.584837,956.373131,949.342496,936.625318,920.702998,902.919627,883.998948,863.940960,842.952447,821.550367,799.321154,776.678374,753.622027,730.048722,706.268633,681.764803,657.157581,632.033400,606.392261,580.440947,553.972674,526.987443,499.485254,471.362714,442.516432,412.843018,382.342469,350.601220,317.412488,282.155922,244.211171,201.717187,150.434909,0.000000,0.000000,0.000000,0.000000,0.000000]

time_off__array = [[   5.0,   5.4,   5.6,   7.0,  11.0,   9.7,  11.2,  11.9,  12.7,  13.9,  14.8,  15.4,  16.3,  17.5,  18.6,  19.2,  19.4,  20.9,  22.3,  27.4,  22.5,  23.8,  24.2,  25.8,  26.2,  27.5,  28.8],[   5.0,   2.9,   5.8,  10.8,   8.1,   9.7,  11.1,  11.3,  12.5,  13.5,  14.1,  14.9,  15.5,  16.4,  17.6,  18.3,  18.9,  19.9,  21.4,  21.4],[   5.0,   2.9,   5.7,   8.7,   8.6,   9.4,   9.9,  10.9,  13.6,  13.3,  14.7,  14.9,  15.4,  16.5,  22.7],[   5.0,   2.9,   5.9,   6.2,   7.6,   9.2,  10.9,  10.3,  11.3,  11.7,  12.2],[   5.0,   3.0,   7.1,   7.1,   7.3,   9.8,   9.3,   9.9,  10.7,  11.8],[   5.0,   3.3,   6.4,   6.6,   7.0,   7.6,   9.6,  10.0,  10.9,  11.2,  11.0],[   5.0,   2.8,   4.7,   5.9,   6.7,  12.1,   9.1,   9.7,  10.5,  11.1,  11.4,  12.9],[   5.0,   3.1,   4.8,   6.0,   6.8,   7.5,  19.5,  11.2,  13.6,  12.1,  12.8,  12.2,  12.5],[   5.0,   3.7,   5.2,   6.5,   7.2,   7.8,   8.4,   9.1,  10.0,  10.7,  11.5,  12.4,  13.2,  14.1,  14.9],[   5.0,   2.3,   4.6,   6.0,   6.4,   7.6,   8.3,   9.1,  10.0,  10.7,  11.5,  12.0,  12.9,  14.4,  14.7,  15.6,  15.7],[   5.0,   2.9,   4.1,   6.3,   7.3,   7.4,   8.6,   8.9,  10.5,  10.7,  12.0,  11.6,  12.4,  13.6,  14.4,  15.2,  15.7,  17.6,  16.7],[   5.0,   4.5,   4.4,   5.3,   6.4,   6.9,   8.1,   8.9,   9.9,  10.3,  11.1,  12.1,  13.3,  13.1,  13.9,  15.0,  15.9,  16.4,  17.9,  17.7,  17.8],[   5.0,   2.9,   4.3,   5.2,   8.3,   7.2,   7.7,   8.7,   9.6,  11.0,  11.3,  11.9,  12.8,  13.3,  14.8,  15.1,  18.0,  16.0,  16.9,  17.8,  19.4,  18.8,  20.1],[   5.0,   2.1,   3.9,   5.2,   6.0,   7.3,   7.8,  10.1,   9.3,  10.2,  11.5,  12.5,  12.4,  13.6,  14.2,  15.2,  18.6,  16.5,  17.6,  18.0,  19.8,  18.9,  20.2,  20.7,  21.2],[   5.0,   1.6,   2.9,   4.0,   5.2,   6.6,   7.7,   8.5,   9.2,  10.3,  10.8,  11.8,  13.0,  13.1,  14.1,  15.0,  16.9,  16.5,  17.1,  18.5,  18.2,  19.5,  20.0,  21.3,  21.1,  22.0,  23.7],[   5.0,   1.6,   2.7,   3.7,   4.4,   5.2,   6.6,   9.3,   9.1,   9.4,  10.6,  13.8,  12.3,  13.7,  13.8,  14.8,  16.5,  16.2,  17.9,  17.9,  18.4,  19.4,  20.6,  20.6,  21.5,  22.5,  23.8,  23.6,  24.4,  24.5],[   5.0,   1.7,   3.3,   3.7,   4.6,   5.4,   5.8,   6.7,   7.4,   8.4,  18.6,  10.6,  14.9,  12.8,  13.4,  14.6,  15.2,  16.3,  17.8,  17.8,  18.9,  19.2,  20.2,  21.3,  21.6,  22.5,  23.5,  24.9,  24.7,  25.6,  26.6,  26.6],[   5.0,   2.6,   3.9,   4.6,   5.5,   6.8,   8.9,   7.6,   7.9,   8.1,   8.8,   9.5,  10.3,  11.2,  12.8,  13.6,  15.3,  15.8,  17.4,  17.7,  19.2,  19.5,  20.7,  21.1,  22.2,  23.6,  23.7,  24.7,  26.0,  26.1,  27.1,  28.1,  29.3,  29.9],[   5.0,   2.2,   4.1,   5.6,   6.5,   8.4,   8.0,   9.2,   9.6,  10.2,  10.9,  10.6,  11.2,  16.0,  11.9,  12.8,  13.3,  14.3,  15.9,  17.8,  18.3,  20.0,  20.4,  22.0,  22.5,  24.0,  24.5,  25.9,  26.4,  27.6,  29.1,  29.3,  30.5,  31.8,  36.4,  33.3,  33.3],[   5.0,   5.2,   4.3,   5.5,   8.2,   7.1,   8.1,   9.4,  10.1,  10.5,  11.7,  11.7,  12.2,  13.3,  13.9,  14.6,  14.8,  15.8,  15.6,  16.2,  16.7,  18.5,  19.8,  21.7,  22.8,  24.6,  28.1,  27.6,  29.9,  31.0,  33.8,  34.6,  34.3,  34.9,  35.0,  34.7,  35.0,  36.0,  38.0],[   5.0,   4.7,   4.4,   6.0,   6.7,   8.4,  10.0,   9.4,  10.2,  10.8,  11.3,  12.4,  13.0,  13.4,  14.0,  15.2,  15.5,  16.1,  17.4,  17.8,  19.1,  19.5,  20.9,  21.1,  22.3,  25.7,  25.7,  24.4,  24.5,  24.1,  24.2,  24.8,  27.0,  24.8,  25.3,  26.0,  25.9,  27.3,  27.4,  27.4,  28.6],[   5.0,   2.2,   5.1,   5.5,   6.4,   7.9,  14.2,   9.7,  10.7,  12.3,  12.1,  12.4,  12.7,  13.9,  14.0,  15.0,  15.9,  16.4,  17.0,  19.1,  18.9,  19.5,  21.0,  21.6,  23.5,  24.5,  29.2,  24.5,  22.9,  21.6,  21.0,  19.9,  19.6,  19.3,  21.2,  19.2,  20.8,  20.4,  22.0,  19.9,  21.6,  21.1,  24.2,  21.0],[   5.0,   2.2,   6.5,   5.9,   6.8,   7.5,   9.4,   9.8,  12.0,  10.6,  11.4,  12.0,  12.9,  13.7,  14.3,  15.0,  16.8,  16.7,  17.8,  17.8,  18.5,  20.5,  20.4,  21.1,  23.0,  23.3,  27.4,  26.4,  29.8,  26.3,  24.0,  22.8,  21.3,  20.6,  19.1,  18.0,  18.5,  16.5,  17.1,  15.7,  15.7,  16.2,  15.2,  16.2,  15.9,  16.2],[   5.0,   2.2,   4.2,   5.3,   6.5,   7.4,   9.9,   8.9,   9.9,  11.8,  15.7,  11.9,  12.8,  13.9,  14.6,  15.4,  15.9,  16.6,  17.3,  18.0,  18.2,  18.9,  21.5,  21.4,  21.8,  24.0,  23.6,  24.4,  26.3,  27.5,  35.4,  27.1,  25.2,  23.6,  22.9,  21.2,  20.2,  19.1,  18.9,  17.0,  17.1,  16.4,  14.5,  14.2,  14.8,  12.8,  12.6,  12.1,  13.3],[   5.0,   2.3,   4.5,   6.2,   6.2,   7.4,   8.1,   9.2,  12.2,  11.0,  16.7,  11.9,  13.1,  13.2,  14.1,  14.9,  15.7,  16.6,  17.5,  18.5,  18.6,  19.7,  20.1,  20.3,  21.2,  24.1,  23.0,  23.6,  24.4,  26.1,  26.9,  28.2,  31.0,  29.4,  29.5,  26.1,  24.3,  22.7,  21.8,  21.0,  20.2,  19.0,  18.1,  16.6,  15.9,  14.9,  14.8,  14.3,  12.4,  11.6,  11.2,  10.7],[   5.0,   2.3,   5.3,   5.5,   7.5,   7.5,   8.3,   8.8,  10.3,  10.9,  11.1,  12.3,  12.5,  14.2,  14.0,  15.0,  16.0,  15.8,  16.7,  17.6,  18.6,  19.4,  20.0,  20.7,  21.2,  21.8,  22.1,  23.2,  24.5,  25.5,  25.7,  26.5,  28.1,  29.2,  31.7,  32.5,  30.0,  27.7,  26.3,  25.1,  24.1,  23.0,  21.8,  21.0,  19.1,  19.7,  17.6,  17.6,  17.1,  17.0,  14.5,  12.3,  11.8,  11.2],[   5.0,   2.3,   4.1,   5.2,   7.2,   7.9,   9.9,  12.4,   9.8,  10.8,  11.9,  11.5,  12.1,  13.8,  14.3,  14.4,  15.4,  17.3,  16.3,  17.8,  17.8,  18.6,  19.4,  20.2,  20.8,  21.6,  22.3,  23.0,  23.7,  24.4,  26.7,  26.2,  26.8,  27.6,  29.3,  30.2,  31.5,  34.5,  32.5,  34.8,  29.0,  27.1,  25.6,  24.7,  23.2,  22.4,  21.1,  20.3,  19.4,  18.5,  17.0,  16.4,  15.3,  20.9,  13.7,  14.6,  12.2],[   5.0,   2.0,   4.7,   6.5,   8.1,   7.3,   8.6,   8.8,   9.2,  10.5,  11.1,  11.7,  12.7,  13.4,  14.0,  14.5,  15.3,  15.9,  18.4,  17.4,  21.5,  18.7,  19.7,  21.2,  34.0,  21.2,  22.0,  22.8,  23.1,  23.9,  24.6,  25.3,  26.3,  27.6,  28.1,  28.8,  29.7,  31.3,  32.3,  35.2,  37.7,  35.1,  31.1,  29.5,  28.0,  28.8,  26.3,  24.7,  23.3,  22.0,  21.1,  20.8,  18.8,  18.2,  17.0,  15.9,  15.8,  16.2,  13.0,  12.5],[   5.0,   2.6,   4.1,   5.5,   6.3,   6.9,   8.6,   9.3,  10.0,  10.5,  10.9,  11.8,  12.2,  13.5,  14.0,  16.2,  15.2,  15.6,  16.5,  23.1,  18.4,  18.1,  20.2,  19.7,  20.7,  22.0,  21.7,  22.5,  23.4,  24.4,  25.4,  25.5,  26.7,  27.2,  27.4,  28.1,  28.9,  30.5,  31.1,  31.9,  40.2,  34.9,  36.6,  37.2,  34.7,  33.4,  30.8,  29.4,  28.2,  27.7,  26.1,  26.5,  24.8,  25.2,  22.0,  20.5,  19.2,  18.1,  16.9,  17.7,  15.4,  14.1,  15.2],[   5.0,   2.1,   4.1,   5.3,   6.3,   6.8,   9.0,   8.7,   9.4,  11.1,  11.4,  11.9,  12.6,  13.0,  14.2,  14.3,  14.8,  15.4,  16.4,  17.0,  17.6,  20.3,  19.1,  19.7,  20.7,  20.7,  21.7,  22.3,  22.9,  23.9,  24.3,  24.8,  25.5,  26.3,  27.4,  27.7,  28.8,  29.2,  31.2,  31.5,  32.1,  33.0,  33.9,  35.7,  36.8,  41.4,  39.1,  35.9,  34.4,  32.3,  31.1,  30.9,  28.2,  27.2,  28.4,  24.9,  23.6,  22.6,  22.6,  22.8,  19.0,  18.0,  17.0,  16.0,  16.1,  15.2],[   5.0,   2.2,   4.1,   6.4,   6.0,   6.8,   8.6,   8.4,  10.7,  11.1,  10.8,  11.6,  12.4,  13.3,  14.0,  14.0,  15.2,  15.4,  16.2,  17.3,  17.7,  18.6,  19.9,  19.8,  20.7,  20.6,  22.7,  22.0,  23.9,  23.4,  25.6,  24.7,  25.6,  26.6,  27.9,  27.4,  28.1,  29.2,  36.1,  31.7,  32.1,  32.6,  33.3,  34.1,  34.9,  36.8,  37.6,  38.9,  41.9,  40.5,  39.0,  36.0,  34.1,  32.9,  31.2,  30.2,  28.9,  28.2,  26.1,  25.7,  26.6,  22.9,  22.2,  20.5,  19.7,  18.8,  18.1,  17.8,  16.5],[   5.0,   2.3,   3.6,   4.9,  10.2,   7.6,   7.6,   8.3,   9.0,  11.3,  10.6,  11.9,  12.0,  13.0,  14.1,  14.6,  15.2,  15.4,  17.5,  16.9,  17.9,  18.3,  19.2,  20.1,  21.1,  21.3,  21.7,  22.5,  22.6,  23.8,  24.1,  24.9,  25.6,  25.9,  27.2,  27.8,  29.1,  28.7,  29.5,  30.3,  31.0,  31.8,  32.6,  33.4,  34.2,  36.1,  36.5,  37.3,  38.3,  40.3,  41.2,  43.1,  43.2,  40.2,  38.8,  36.6,  34.8,  34.1,  32.2,  30.6,  30.1,  28.6,  27.2,  26.0,  24.6,  23.9,  22.3,  21.7,  20.2,  19.5,  18.4,  19.3],[   5.0,   3.4,   3.7,   4.9,   6.2,   6.8,   7.6,   8.4,   9.3,  10.5,  10.7,  11.3,  12.8,  13.2,  13.6,  15.1,  18.9,  15.5,  16.3,  16.9,  17.5,  19.3,  19.0,  20.0,  20.2,  21.2,  22.3,  22.1,  22.8,  23.4,  24.8,  25.0,  25.5,  29.1,  27.2,  27.5,  28.6,  28.9,  29.8,  30.6,  31.6,  32.7,  35.2,  35.5,  34.0,  34.9,  35.7,  37.6,  38.0,  38.7,  39.5,  40.5,  42.3,  43.3,  48.6,  47.6,  43.7,  41.3,  41.4,  38.2,  36.3,  34.6,  33.1,  34.1,  30.8,  29.3,  28.2,  27.8,  25.8,  24.4,  24.2,  22.4,  21.0,  20.9,  19.5],[   5.0,   1.8,   3.6,   4.8,  12.0,   6.8,   8.0,   8.6,   9.7,  10.7,  11.1,  11.7,  13.1,  13.2,  13.9,  14.6,  15.3,  17.1,  17.0,  17.9,  19.4,  18.8,  19.5,  20.2,  20.8,  22.0,  22.1,  23.2,  23.4,  24.3,  25.2,  26.2,  27.0,  27.3,  27.7,  28.2,  30.0,  29.9,  30.3,  31.5,  31.7,  32.7,  34.4,  33.8,  34.7,  35.5,  36.3,  37.1,  37.9,  38.7,  39.5,  40.3,  41.2,  43.3,  43.7,  44.5,  45.6,  47.7,  49.6,  48.7,  47.7,  44.3,  42.0,  40.0,  38.2,  36.5,  34.9,  33.4,  32.0,  30.6,  30.1,  28.5,  27.1,  25.8,  24.5,  24.0,  22.6,  21.3,  20.9],[   5.0,   5.9,   5.8,   5.7,   5.7,   2.1,   5.6,   8.2,  11.1,  11.8,  13.1,  14.8,  18.5,  18.8,  20.1,  19.2,  20.5,  20.0,  20.8,  21.0,  21.5,  22.0,  23.1,  23.3,  24.0,  24.6,  25.3,  26.0,  26.5,  27.0,  28.1,  28.2,  29.0,  29.9,  33.1,  30.8,  31.5,  32.2,  32.8,  34.0,  34.3,  35.8,  35.8,  36.2,  37.3,  40.7,  38.5,  39.5,  40.4,  41.4,  42.4,  43.1,  43.7,  44.5,  45.2,  46.0,  46.8,  47.7,  48.6,  50.4,  51.3,  52.7,  55.4,  54.3,  50.5,  47.6,  45.2,  43.1,  41.2,  39.4,  37.7,  36.1,  34.6,  33.1,  32.1,  30.3,  35.1,  28.8,  27.2,  25.8,  24.9,  23.2,  22.7],[   5.0,   5.9,   5.8,   5.7,   5.7,   5.7,   5.7,   5.7,   5.7,   5.7,   5.7,   5.7,   5.7,   5.7,   5.7,   5.7,   5.7,   5.7,   5.7,   5.7,   4.8,   6.6,   8.0,   9.8,  11.3,  16.9,  13.0,  15.4,  17.7,  16.2,  17.4,  19.0,  19.2,  20.4,  21.3,  22.4,  24.1,  23.9,  24.9,  26.1,  27.0,  27.8,  29.3,  28.9,  30.0,  31.0,  32.2,  33.4,  34.6,  36.3,  34.6,  35.6,  36.7,  37.9,  40.1,  38.8,  39.8,  40.8,  41.8,  43.1,  45.1,  44.0,  45.2,  46.7,  46.9,  48.3,  50.0,  50.4,  52.1,  55.3,  56.8,  52.5,  49.1,  46.5,  44.5,  44.8,  39.2,  37.5,  35.8,  34.3,  32.8,  31.4,  30.0,  28.7,  27.4,  27.7,  25.8,  26.2],[   5.6,   5.6,   5.6,   5.6,   5.6,   5.6,   5.6,   5.6,   5.6,   5.6,   5.6,   5.6,   5.6,   5.6,   5.6,   5.6,   5.6,   5.6,   5.6,   5.6,   5.6,   5.6,   5.6,   5.6,   5.6,   5.6,   5.6,   5.6,   5.6,   5.6,   5.6,   5.6,   5.6,   5.6,   5.6,   5.6,   5.6,   5.6,   5.6,   5.6,   5.6,   5.6,   5.6,   1.3,   4.6,   7.1,   8.9,  11.7,  12.6,  13.8,  13.1,  14.3,  15.7,  16.8,  17.4,  17.9,  18.8,  20.3,  21.0,  21.2,  22.1,  23.7,  23.9,  25.3,  25.8,  27.1,  26.9,  28.4,  29.3,  30.2,  31.1,  31.3,  33.1,  35.4,  33.5,  35.0,  35.5,  36.7,  38.5,  37.6,  38.6,  39.8,  41.0,  43.0,  42.5,  44.0,  44.6,  46.3,  48.6,  50.3,  47.5,  44.4,  42.1,  40.3,  39.0,  35.3,  33.6,  32.1,  30.7,  29.3,  27.9,  26.6],[   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,  13.6,   5.9,   7.1,   9.3,  16.1,  11.6,  15.5,  13.2,  15.6,  15.2,  16.5,  17.6,  18.3,  19.3,  21.0,  20.4,  21.4,  22.2,  23.0,  23.9,  25.0,  26.4,  28.9,  26.9,  27.8,  28.6,  29.5,  30.4,  31.6,  33.4,  32.6,  33.7,  34.3,  36.6,  39.5,  37.1,  38.4,  40.1,  79.9,  41.1,  42.9,  44.2,  45.6,  41.4,  38.8,  36.8,  35.5,  32.4,  30.8,  29.3],[   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   4.9,   6.2,   9.1,  12.0,  10.7,  12.4,  14.4,  13.9,  15.5,  15.2,  16.1,  18.7,  22.3,  18.9,  20.0,  21.0,  21.7,  22.5,  23.6,  25.2,  24.5,  25.5,  26.4,  27.3,  27.6,  29.2,  30.5,  32.4,  30.8,  32.0,  33.5,  33.4,  34.6,  35.9,  37.6,  38.0,  39.9,  43.7,  38.7,  35.7,  33.5],[   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   3.8,   6.8,   7.8,   9.1,  11.5,  11.0,  12.1,  14.2,  13.9,  15.0,  15.8,  18.9,  17.6,  18.7,  19.7,  20.4,  20.6,  22.1,  23.5,  26.4,  24.2,  25.1,  26.0,  26.4,  28.1,  28.5,  32.7,  30.3,  31.1,  33.0,  32.9,  34.3,  36.2],[   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   5.5,   4.5,   6.7,   9.0,   9.9,  10.5,  11.8,  12.2,  13.4,  14.5,  15.1,  15.8,  17.0,  18.1,  18.3,  19.7,  20.4,  21.6,  22.3,  22.1,  23.0,  23.8,  24.8,  25.8,  26.9,  28.8]]

#%%
rate = WRSpice.WRSpice(tempCirFile = 'dend__3jj__nest__cnst_drv', OutDatFile = 'dend_3jj_nest_cnst_drv_seek_rt_arry_') # no file extentions
rate.pathWRSSpice = '/raid/home/local/xictools/wrspice.current/bin/wrspice'  # for running on grumpy
# rate.pathWRSSpice='C:/usr/local/xictools/wrspice/bin/wrspice.bat' # for local computer

rate.save = 'i(L1) v(2) v(13)' # list all vectors you want to save
rate.pathCir = ''

FileFormat = 'Ib{:06.2f}uA_Lp{:05.2f}pH_Ip{:09.6f}uA_Iex{:09.6f}'

for ii in range(len(Phi_p_list)):
    Phi_ex_on = Phi_ex_on_list[ii]
    Phi_ex_vec = np.append( np.insert( np.arange(Phi_ex_on,max_flux,_fr) ,0,Phi_ex_on-_fr_0 ) , max_flux ) 
    # print('Phi_a_vec = {}'.format(Phi_a_vec))
    # time.sleep(1)
    
    for jj in range(len(Phi_ex_vec)):

        print('ii = {} of {}; jj = {} of {}'.format(ii+1,len(Phi_p_list),jj+1,len(Phi_ex_vec)))
            
        Iex = Phi_ex_vec[jj]/Mex
        Ip = Phi_p_list[ii]/Mp
        FilePrefix = FileFormat.format(Ib,Lp,Ip,Iex)
        rate.FilePrefix = FilePrefix
                    
        Params = {          
        'Ip':'{:9.6f}u'.format(np.round(Ip,6)),
        'Ib':'{:6.2f}u'.format(np.round(Ib,2)),
        'Iex':'{:9.6f}u'.format(np.round(Iex,6)),
        'Lp':'{:5.2f}p'.format(Lp)
        }
    
        print('Ib = {:06.2f}uA; Ip = {:9.6f}uA; Iex = {:9.6f}uA'.format(Ib,Ip,Iex))
        
        rate.Params = Params
        rate.stepTran = '1p'
        _ts = '{:f}n'.format(time_off__array[ii][jj])
        rate.stopTran = _ts
        rate.doAll()
