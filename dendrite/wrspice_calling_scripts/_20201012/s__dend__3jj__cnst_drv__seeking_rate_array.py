import numpy as np
import time

from util import physical_constants
p = physical_constants()

import WRSpice

#%%

# tempCirFile only netlist
# export your netlist to a cir file using 'deck' command in xic
# open the cir file and remove all lines except the netlist lines
# replace all values by Params, you want to sweep, with white space around
# Component names don't need any changes
# VERY IMPORTTANT Leave a blank line in the start and end of the  cir file

#%%
num_jjs = 4
M = np.sqrt(200*20)

#%% load flux onset vector

# with open('dend_{:1d}jj_flux_onset.soen'.format(num_jjs), 'rb') as data_file:         
#     data_array_imported = pickle.load(data_file)

# I_de_list = data_array_imported['I_de_list']
# Phi_a_on = data_array_imported['Phi_a_on']

if num_jjs == 2:

    # dendritic firing junction bias current
    dI_de = 1
    I_de_0 = 52
    I_de_f = 80

elif num_jjs == 4:
    
    # dendritic firing junction bias current
    dI_de = 1
    I_de_0 = 56
    I_de_f = 85
    
I_de_list = np.arange(I_de_0,I_de_f+dI_de,dI_de)
num_I_de = len(I_de_list)

I_drive_on__vec = [16.1648,15.7114,15.2568,14.8008,14.3432,13.8840,13.4228,12.9596,12.4940,12.0260,11.5552,11.0812,10.6038,10.1226, 9.6372, 9.1470, 8.6510, 8.1490, 7.6398, 7.1220, 6.5942, 6.0544, 5.4998, 4.9266, 4.3284, 3.6958, 3.0102, 2.2290, 1.1768, 0.0000]
time_off__array = [[  79.4, 133.5,  91.6],[ 105.5, 130.1,  87.7,  75.7,  69.2,  65.1,  62.3,  60.1],[  82.4, 127.3,  84.5,  72.3,  65.9,  61.8,  58.9,  56.7,  60.3,  57.4,  55.8,  54.7,  53.8,  53.0],[  77.3, 126.5,  82.5,  69.8,  63.0,  58.5,  55.4,  53.0,  56.8,  53.9,  55.1,  51.4,  50.6,  49.9,  49.4,  48.9,  48.5,  48.2,  47.9],[  76.8, 126.5,  81.8,  68.8,  61.7,  56.9,  53.6,  50.9,  62.8,  54.4,  52.0,  50.2,  49.0,  50.0,  49.8,  49.5,  42.9,  42.7,  42.9,  42.9,  43.0,  43.1,  43.1,  43.2,  43.2],[  85.8, 126.7,  81.4,  68.4,  61.2,  56.4,  52.9,  50.1,  61.9,  53.1,  50.4,  48.3,  46.7,  47.0,  44.2,  43.3,  42.4,  43.0,  48.4,  41.4,  40.9,  40.6,  40.5,  42.7,  41.0,  42.2,  38.1,  38.4,  38.8,  39.2,  39.5],[  92.0, 127.2,  81.1,  68.0,  60.8,  56.0,  52.5,  49.7,  58.7,  54.8,  49.8,  47.7,  47.7,  44.6,  43.4,  42.3,  42.7,  40.4,  41.1,  39.8,  42.0,  38.3,  37.8,  37.3,  38.8,  36.6,  36.3,  36.1,  37.4,  35.9,  36.0,  36.1,  37.7,  37.6,  38.0,  38.8],[  86.0, 127.7,  80.9,  67.7,  61.8,  55.6,  52.2,  49.4,  61.8,  52.3,  49.4,  47.3,  47.3,  44.2,  42.9,  43.3,  40.8,  41.2,  40.9,  39.2,  38.3,  37.5,  36.9,  38.3,  35.8,  35.3,  36.5,  34.5,  35.5,  33.8,  33.6,  33.3,  42.5,  33.8,  33.5,  33.4,  33.3,  33.3,  33.4,  33.5,  33.7,  33.9],[  76.3, 128.7,  80.9,  67.5,  60.2,  55.4,  52.9,  49.1,  59.1,  52.0,  49.1,  48.8,  45.3,  43.8,  42.6,  41.4,  40.4,  40.8,  42.2,  38.8,  37.9,  37.1,  38.7,  35.8,  35.3,  34.8,  35.9,  33.8,  33.4,  33.0,  32.6,  32.3,  34.6,  36.6,  35.1,  31.8,  31.6,  31.4,  33.0,  32.7,  32.5,  32.4,  30.9,  30.9,  32.2,  39.5,  31.8,  31.8],[  75.7, 129.6,  80.8,  67.4,  60.0,  55.2,  52.7,  48.9,  59.7,  51.8,  48.9,  48.6,  45.0,  43.6,  42.3,  41.2,  40.2,  39.3,  38.4,  43.4,  37.6,  36.8,  36.1,  37.6,  34.9,  34.4,  33.9,  33.4,  33.0,  33.9,  32.2,  31.8,  32.6,  36.6,  31.5,  31.1,  30.8,  30.5,  30.3,  30.1,  29.9,  29.7,  29.6,  29.5,  29.4,  31.8,  33.8,  29.7,  29.6,  29.5,  29.5,  29.5,  29.5],[  76.5, 130.8,  82.9,  67.3,  59.9,  55.1,  52.5,  48.7,  60.7,  51.7,  48.7,  46.6,  44.8,  43.4,  43.6,  41.0,  41.3,  39.0,  38.2,  44.0,  37.4,  36.6,  35.9,  35.3,  36.6,  34.2,  33.6,  33.2,  32.7,  32.3,  31.9,  31.5,  31.1,  37.0,  31.1,  30.7,  30.3,  30.0,  29.7,  29.5,  29.3,  30.5,  28.9,  28.7,  29.8,  29.6,  29.2,  31.7,  28.6,  30.4,  30.0,  29.9,  28.1,  29.5,  29.3,  29.2,  27.9,  28.7,  28.4],[ 104.2, 132.6,  80.9,  68.9,  59.8,  54.9,  51.3,  48.6,  62.9,  51.7,  48.6,  46.4,  46.4,  43.2,  43.6,  40.8,  41.2,  38.9,  38.0,  38.7,  41.0,  36.5,  35.8,  35.1,  34.5,  35.7,  35.1,  34.6,  32.5,  32.0,  31.6,  32.5,  30.9,  31.9,  34.5,  30.4,  30.0,  31.7,  29.4,  29.1,  30.4,  28.6,  28.4,  28.2,  28.0,  27.9,  28.8,  28.2,  28.0,  27.8,  27.6,  27.5,  28.8,  28.6,  28.4,  28.3,  28.1,  32.1,  27.4,  27.2,  28.8,  27.0,  26.9,  28.1,  33.1],[  80.9, 134.6,  81.0,  67.3,  59.8,  54.9,  51.3,  48.5,  78.3,  51.8,  48.6,  46.4,  44.6,  43.1,  43.4,  40.7,  41.0,  40.1,  37.9,  39.5,  37.2,  36.4,  38.1,  35.0,  34.4,  33.8,  33.3,  32.8,  33.8,  31.9,  31.5,  32.3,  30.7,  44.5,  34.8,  30.2,  32.2,  29.5,  29.2,  28.9,  28.6,  28.3,  28.1,  27.9,  27.7,  27.5,  28.8,  27.9,  27.6,  27.4,  27.2,  28.7,  28.4,  26.7,  26.6,  26.5,  27.6,  33.3,  26.8,  26.6,  26.4,  27.9,  26.2,  27.3,  34.3,  32.2,  29.5,  30.7,  30.3,  30.0,  28.4],[  74.1, 137.1,  81.2,  67.3,  59.8,  54.9,  51.2,  48.4, 122.6,  54.5,  48.6,  46.3,  44.5,  43.0,  41.7,  40.6,  39.6,  38.6,  37.8,  37.0,  37.3,  36.3,  35.5,  37.2,  34.3,  33.7,  34.8,  34.3,  32.2,  33.1,  31.3,  30.9,  30.5,  30.1,  30.8,  30.1,  32.3,  29.3,  29.0,  30.4,  30.0,  28.1,  27.9,  28.9,  28.6,  28.4, 306.4,  31.8,  27.3,  27.1,  26.9,  28.4,  26.5,  26.4,  26.2,  27.4,  26.0,  29.5,  29.9,  28.5,  26.0,  25.8,  25.7,  25.5,  29.4,  30.5,  29.3,  31.3,  28.4,  30.7,  27.9,  30.3,  30.1,  27.5,  29.7,  27.4,  29.4],[  77.2, 140.1,  81.5,  67.4,  59.9,  56.1,  51.2,  48.4,  65.7,  52.0,  48.6,  46.3,  44.5,  43.0,  41.7,  40.5,  39.5,  38.6,  39.0,  36.9,  37.4,  36.3,  35.5,  34.8,  36.3,  33.6,  33.1,  32.6,  32.1,  31.6,  32.5,  32.1,  30.4,  31.3,  37.1,  30.1,  32.4,  29.2,  28.8,  28.5,  28.2,  28.0,  27.7,  28.8,  28.5,  27.0,  26.8,  32.7,  30.3,  29.3,  28.7,  26.4,  26.2,  26.1,  25.9,  25.8,  25.7,  26.7,  26.3,  25.9,  27.8,  25.5,  25.3,  26.4,  25.0,  42.4,  36.9,  35.0,  34.0,  33.4,  33.1,  32.9,  33.4,  39.5,  29.4,  27.3,  27.4,  27.5,  27.4,  27.4,  27.4,  26.1,  27.3],[  82.2, 144.0,  81.8,  67.6,  59.9,  56.2,  51.2,  48.4,  47.0,  52.3,  51.1,  46.3,  44.5,  43.0,  41.7,  40.5,  40.9,  38.5,  37.7,  38.1,  38.4,  36.3,  38.4,  34.7,  34.1,  33.5,  34.7,  34.1,  33.5,  31.6,  31.1,  30.7,  30.3,  29.9,  32.6,  30.1,  29.5,  29.1,  28.7,  30.2,  28.1,  29.4,  29.0,  27.3,  27.1,  26.9,  26.7,  37.0,  30.6,  26.7,  26.4,  26.2,  26.0,  25.9,  25.7,  27.0,  26.7,  25.3,  26.6,  28.8,  25.4,  25.2,  25.0,  24.9,  25.9,  73.1,  37.3,  34.7,  33.3,  32.4,  31.8,  31.3,  30.9,  42.1,  33.4,  32.1,  31.4,  29.0,  30.8,  30.6,  30.5,  30.7,  30.9,  35.3,  36.1,  25.3,  26.7,  26.9,  26.8],[  76.2, 151.6,  82.3,  67.8,  60.1,  55.0,  51.3,  48.4,  46.0,  52.7,  48.8,  46.4,  46.6,  44.9,  41.7,  40.5,  41.0,  38.5,  37.6,  38.1,  37.4,  36.5,  35.5,  34.7,  36.3,  35.5,  33.0,  34.1,  32.0,  31.5,  31.1,  30.6,  31.5,  29.9,  30.7,  35.5,  29.5,  29.0,  28.7,  28.3,  28.0,  27.7,  27.4,  27.2,  27.0,  28.0,  26.5,  26.3,  31.7,  26.6,  26.3,  26.1,  25.9,  27.3,  25.5,  26.7,  25.2,  25.1,  26.2,  25.7,  25.3,  25.0,  24.9,  24.7,  25.9,  25.6,  39.7,  35.2,  33.4,  32.3,  31.5,  30.9,  30.4,  30.0,  34.5,  31.9,  30.8,  30.3,  29.8,  29.5,  29.2,  29.0,  28.8,  36.8,  31.4,  30.2,  29.8,  27.6,  29.4,  29.2,  29.2,  29.3,  35.2,  32.3,  32.3],[  72.7, 341.4,  82.9,  68.1,  60.3,  55.1,  51.4,  49.5,  46.1,  56.5,  51.6,  46.6,  44.7,  43.1,  41.7,  40.5,  39.5,  38.5,  39.0,  36.8,  36.1,  45.4,  35.6,  34.8,  34.1,  33.5,  33.0,  32.4,  31.9,  31.5,  31.0,  31.9,  30.2,  29.8,  29.4,  41.8,  29.6,  31.9,  31.0,  28.3,  27.9,  27.6,  27.4,  28.5,  26.9,  26.6,  26.4,  27.4,  35.7,  26.6,  26.2,  28.1,  25.8,  27.3,  25.4,  25.2,  25.1,  26.3,  24.8,  26.1,  28.3,  24.9,  24.7,  26.1,  25.8,  24.2,  65.7,  36.4,  33.9,  32.5,  31.5,  30.8,  30.2,  28.4,  29.4,  28.6,  30.8,  30.1,  29.5,  29.1,  28.8,  27.1,  28.3,  28.1,  32.4,  30.1,  29.2,  28.7,  28.4,  28.1,  26.5,  27.8,  27.7,  31.3,  29.6,  28.9,  28.6,  28.3,  26.7,  28.2,  28.1],[  70.7, 165.4,  83.5,  68.5,  60.5,  55.3,  51.5,  48.7,  46.2,  54.1,  49.3,  46.7,  46.9,  45.1,  41.8,  40.6,  39.5,  40.0,  37.7,  36.9,  36.1,  35.4,  40.9,  38.2,  36.9,  35.8,  33.0,  32.5,  32.0,  31.5,  31.0,  30.6,  30.2,  29.8,  29.4,  29.1,  29.8,  32.5,  31.2,  30.4,  27.9,  27.6,  27.3,  28.5,  28.2,  26.6,  26.3,  26.1,  25.9,  31.5,  26.2,  28.3,  25.7,  25.5,  25.3,  25.1,  25.0,  24.8,  24.7,  25.7,  29.5,  27.5,  26.6,  24.4,  24.2,  24.1,  23.9,  40.1,  34.9,  32.9,  31.7,  29.2,  30.2,  29.7,  29.3,  37.3,  28.1,  30.2,  29.5,  28.9,  28.6,  28.3,  28.0,  27.7,  27.6,  30.9,  29.3,  28.6,  28.1,  27.7,  27.5,  27.3,  27.1, 210.4,  26.4,  26.1,  25.9,  27.6,  27.3,  27.2,  27.0,  26.9,  30.3,  28.6,  28.0,  27.6,  27.4],[  90.6, 161.6,  84.4,  68.9,  60.8,  55.5,  51.7,  48.8,  46.3,  59.6,  52.6,  49.4,  47.2,  43.4,  42.0,  42.4,  41.3,  38.7,  37.8,  37.0,  36.2,  36.7,  36.9,  35.1,  34.3,  33.6,  33.0,  32.5,  32.0,  31.5,  31.1,  30.6,  31.6,  31.1,  30.7,  29.1, 296.1,  33.5,  31.6,  30.8,  27.9,  29.5,  27.3,  27.0,  26.8,  26.5,  26.3,  27.4,  25.9,  29.7,  26.3,  25.9,  25.6,  25.4,  25.2,  25.1,  24.9,  24.7,  25.8,  25.6,  28.0,  28.3,  26.9,  24.3,  24.2,  24.0,  25.1,  33.0,  37.2,  33.8,  32.2,  29.3,  30.4,  29.8,  29.3,  28.9,  34.2,  30.8,  29.7,  29.1,  28.5,  28.1,  27.8,  27.6,  27.4,  45.6,  30.0,  28.8,  28.1,  27.6,  27.3,  27.0,  26.8,  26.7,  35.1,  29.0,  27.9,  27.4,  27.0,  26.7,  26.5,  26.4,  26.2,  29.1,  27.8,  27.2,  26.8,  25.0,  26.4,  26.2,  30.7,  28.0,  27.2],[  69.0, 157.8,  85.6,  69.5,  61.2,  55.9,  52.0,  49.0,  46.6,  63.7,  50.3,  47.4,  45.3,  43.6,  42.2,  40.9,  39.8,  38.8,  37.9,  38.5,  36.3,  36.8,  34.9,  35.6,  34.5,  33.8,  35.6,  32.6,  32.1,  33.4,  32.7,  30.7,  30.3,  29.9,  29.5,  29.1,  30.0,  38.0,  28.9,  28.4,  30.3,  27.6,  27.3,  27.0,  28.3,  26.5,  27.6,  26.1,  25.8,  26.8,  34.3,  29.4,  25.7,  25.4,  25.2,  25.0,  24.8,  26.1,  25.8,  24.4,  24.2,  25.5,  24.6,  24.3,  24.1,  23.9,  23.8,  24.8,  57.6,  35.9,  33.2,  31.8,  30.8,  28.4,  29.4,  29.0,  27.2,  33.3,  30.3,  29.3,  28.7,  28.2,  27.9,  27.5,  27.3,  27.0,  37.6,  29.6,  28.3,  27.7,  27.3,  27.0,  26.7,  26.5,  26.3,  33.2,  28.6,  27.5,  27.0,  26.6,  24.8,  26.0,  25.9, 290.4,  28.5,  27.3,  26.7,  26.3,  26.1,  25.8,  25.7,  29.7,  27.4,  26.6,  26.2,  25.9,  25.6,  33.8,  27.4,  26.5],[  75.2, 157.0,  87.3,  70.3,  61.7,  56.3,  52.3,  49.3,  46.9,  63.1,  51.2,  50.9,  48.1,  43.9,  42.4,  41.2,  40.0,  39.0,  38.1,  38.7,  36.5,  37.0,  35.1,  34.4,  34.9,  34.0,  33.3,  32.8,  34.3,  31.7,  31.3,  30.8,  30.4,  30.0,  29.6,  30.5,  28.8,  29.6,  29.4,  28.6,  28.1,  29.9,  27.4,  27.1,  26.8,  28.1,  26.3,  26.1,  25.9,  25.6,  25.5,  32.4,  25.8,  27.9,  27.3,  25.0,  26.5,  24.7,  25.9,  24.3,  24.2,  24.1,  25.1,  24.4,  24.1,  25.7,  25.3,  23.6,  24.6,  44.9,  35.2,  30.4,  31.4,  30.4,  29.7,  29.2,  28.7,  28.3,  33.3,  30.2,  29.1,  28.5,  28.0,  27.6,  27.3,  27.0,  26.7,  28.0,  29.4,  28.1,  27.4,  27.0,  25.0,  26.4,  26.2,  26.0,  34.1,  28.3,  27.3,  26.7,  26.3,  26.0,  25.8,  25.5,  25.4,  28.3,  27.0,  26.3,  25.9,  25.6,  25.4,  25.2,  29.7,  27.0,  26.2,  25.8,  25.4,  25.2,  39.4,  27.0,  25.9,  24.0,  25.2,  26.9,  39.0,  41.4],[  75.6, 160.1,  87.2,  71.3,  62.5,  56.8,  54.2,  49.7,  47.2,  45.1,  57.6,  48.6,  46.2,  44.3,  45.1,  41.5,  40.3,  41.0,  38.3,  37.5,  36.7,  37.3,  35.3,  34.6,  34.0,  34.5,  33.6,  33.0,  32.4,  31.9,  31.4,  31.0,  32.2,  30.1,  29.7,  30.7,  29.0,  28.6,  28.3,  29.2,  28.4,  30.6,  29.8,  27.2,  26.9,  28.3,  27.9,  27.5,  25.9,  25.7,  25.5,  26.4,  26.3,  25.6,  25.3,  25.1,  26.7,  24.7,  24.5,  25.7,  25.5,  24.1,  25.0,  24.9,  27.2,  24.0,  23.8,  23.6,  23.4,  24.4,  45.0,  35.2,  32.7,  31.3,  30.3,  29.6,  29.0,  28.5,  28.2,  35.4,  30.3,  29.0,  28.3,  27.8,  25.8,  27.0,  26.9,  26.5,  26.3,  29.6,  28.0,  27.3,  25.0,  26.5,  26.2,  25.9,  25.7,  25.5,  28.5,  27.1,  26.5,  26.1,  25.7,  25.5,  25.3,  25.1,  24.6,  26.9,  26.1,  25.7,  25.4,  25.1,  24.9,  32.5,  27.0,  26.0,  25.5,  25.2,  24.9,  24.7,  27.1,  25.8,  25.1,  23.4,  27.7,  57.0,  36.0,  33.6,  32.3,  31.5,  30.8,  30.4,  29.9],[  85.3, 156.3,  89.3,  72.7,  63.4,  57.6,  53.4,  50.3,  47.7,  45.5,  57.7,  49.7,  46.9,  44.9,  43.3,  41.9,  42.8,  39.7,  38.7,  37.8,  38.5,  37.7,  35.6,  34.9,  34.3,  33.7,  34.2,  33.4,  32.7,  32.2,  31.7,  31.2,  30.7,  32.0,  29.9,  29.5,  29.1,  28.8,  28.4,  28.1,  36.3,  28.2,  27.8,  27.4,  27.1,  26.8,  26.5,  27.8,  27.5,  25.8,  25.6,  26.5,  26.3,  34.1,  25.6,  25.2,  27.1,  26.7,  24.6,  24.4,  24.2,  24.1,  23.9,  23.8,  25.3,  24.2,  23.9,  23.7,  25.1,  24.8,  23.2,  76.4,  36.0,  30.4,  31.4,  30.4,  29.6,  29.0,  28.5,  28.0,  27.7,  31.0,  29.2,  28.4,  25.9,  27.4,  27.0,  26.7,  26.4,  24.9,  31.4,  28.3,  27.4,  26.8,  26.4,  26.0,  25.8,  25.6,  25.4,  29.8,  27.4,  26.5,  26.0,  25.5,  25.4,  25.1,  23.7,  31.9,  27.1,  26.0,  25.6,  25.3,  24.9,  24.8,  24.6,  27.6,  26.1,  25.4,  25.0,  24.6,  24.4,  28.7,  25.9,  25.0,  24.6,  24.3,  25.3, 149.1, 110.0,  29.8,  30.6,  30.6,  30.8,  31.0,  31.1,  31.1,  30.9,  30.4,  30.1,  29.7],[  64.2, 150.2,  92.5,  75.8,  64.8,  58.6,  54.3,  51.0,  48.4,  46.2,  69.8,  50.2,  48.2,  45.8,  44.1,  42.6,  41.3,  42.2,  41.0,  38.3,  37.4,  38.1,  35.9,  36.6,  34.6,  35.3,  34.7,  34.4,  33.2,  32.6,  32.0,  33.7,  31.1,  30.6,  30.2,  31.3,  29.4,  29.0,  28.7,  28.3,  28.0,1665.2,  28.3,  30.8,  27.3,  29.1,  28.6,  26.4,  26.2,  25.9,  25.7,  25.5,  26.6,  25.1,  24.9,  25.6,  25.2,  27.3,  26.7,  24.5,  24.3,  24.2,  25.4,  23.9,  23.7,  24.7,  24.3,  23.9,  23.7,  25.2,  23.3,  23.1, 365.9,  39.3,  34.1,  32.0,  30.7,  29.8,  29.1,  28.5,  26.7,  26.3,  28.1,  30.1,  28.7,  25.8,  27.4,  27.1,  26.7,  26.5,  26.2,  25.9,  29.6,  27.7,  26.9,  26.5,  26.1,  25.8,  25.6,  24.0,  25.1,  28.5,  26.8,  26.1,  25.7,  25.3,  25.1,  24.9,  24.7,  29.0,  26.6,  25.7,  25.3,  24.9,  24.6,  24.4,1856.7,  26.8,  25.5,  25.0,  24.6,  24.3,  24.1,  27.1,  25.3,  24.7,  24.2,  30.1,  37.9, 179.7, 137.7, 120.3, 138.2, 115.9, 111.6, 110.2, 111.1, 130.3, 127.0, 156.8,  96.5,  29.1,  37.4,  28.0,  28.3,  28.5,  28.7,  28.7],[  64.3, 139.8,  97.3,  75.8,  67.0,  60.2,  55.6,  52.1,  50.7,  47.1,  45.1,  53.6,  48.7,  59.4,  45.3,  43.6,  42.2,  41.0,  42.1,  39.0,  39.8,  39.0,  38.1,  35.8,  36.5,  34.5,  34.0,  34.7,  34.1,  33.5,  32.7,  32.1,  31.5,  33.1,  30.6,  30.2,  29.8,  29.4,  29.1,  28.7,  28.4,  28.0,  27.7,  38.7,  31.9,  27.4,  27.1,  28.8,  26.5,  26.2,  27.5,  25.7,  25.5,  25.3,  25.1,  26.0,  51.8,  25.4,  25.0,  24.7,  24.5,  26.1,  25.7,  24.0,  23.9,  25.0,  23.6,  23.5,  27.7,  23.7,  23.5,  24.9,  23.1,  23.0,  23.5,  38.2,  33.7,  31.7,  30.4,  29.6,  28.9,  26.8,  26.5,  27.5,  29.7,  30.1,  26.0,  27.9,  27.3,  26.9,  26.6,  24.8,  26.0,  25.8,  30.0,  27.6,  26.8,  26.3,  24.2,  25.6,  25.3,  25.2,  25.0,  28.7,  26.8,  26.0,  25.4,  25.2,  24.9,  24.7,  24.5,  29.8,  26.5,  25.6,  23.3,  24.7,  24.4,  22.9,  24.0,  26.9,  25.5,  24.8,  24.5,  24.1,  23.9,  27.6,  25.2,  24.5,  24.0,  23.7,  33.4, 141.1, 136.6, 115.2, 144.2, 108.1, 101.9,  98.3,  95.8,  94.2,  97.5,  94.8,  93.7,  97.4,  95.3, 102.0,  98.1, 106.2, 102.8, 110.3, 113.7, 130.9, 188.9,  83.8,  29.4],[  63.3, 145.5, 106.7,  80.1,  68.7,  63.0,  57.7,  53.9,  50.9,  48.5,  46.5,  44.7,  52.4,  48.3,  46.0,  50.9,  43.9,  45.7,  43.9,  40.0,  39.1,  38.2,  37.4,  36.7,  36.0,  35.3,  34.7,  35.5,  33.6,  33.1,  32.6,  33.5,  32.4,  31.8,  31.3,  32.9,  32.3,  31.7,  31.3,  29.2,  28.9,  29.9,  28.2,  27.9,  27.6,  27.3,  27.9,  30.5,  27.0,  28.8,  26.4,  26.1,  27.4,  27.2,  25.4,  25.2,  25.0,  24.8,  24.7,  25.5,  25.0,  24.7,  26.5,  26.1,  24.1,  23.9,  23.8,  23.7,  23.5,  23.4,  24.3,  26.6,  23.5,  25.0,  24.6,  24.2,  22.7,  47.0,  31.5,  32.4,  30.9,  29.8,  29.1,  28.5,  28.0,  27.5,  27.2,  33.5,  29.4,  28.2,  27.5,  27.0,  26.6,  26.3,  26.0,  25.7,  25.5,  28.9,  27.3,  26.5,  26.0,  25.7,  25.4,  25.1,  24.9,  24.8,  27.8,  26.3,  25.7,  25.3,  24.9,  24.7,  23.1,  23.0,  28.2,  26.0,  25.2,  24.8,  24.5,  24.2,  24.0,  37.7,  26.2,  25.1,  24.5,  24.2,  23.9,  23.6,  26.4,  24.8,  24.1,  22.4,  27.8,  37.3, 185.5, 129.9, 112.4, 104.0,  98.7,  95.0, 177.0,  95.5,  91.6,  89.3,  99.2,  90.0,  87.8,  92.3,  88.0,  95.0,  88.2,  93.2,  88.3,  90.8, 103.8,  90.2,  92.2,  95.3, 100.3, 117.5,  97.2, 100.4, 154.5, 120.4],[  65.8, 114.2, 139.1,  89.6,  74.9,  66.5,  60.9,  57.6,  54.0,  51.3,  49.0,  47.0,  45.2,  61.3,  50.1,  47.3,  45.4,  45.3,  43.9,  42.5,  41.1,  42.9,  39.1,  38.2,  37.4,  36.7,  36.0,  35.4,  36.3,  34.2,  35.1,  34.5,  32.7,  32.2,  35.0,  32.3,  31.6,  31.1,  32.8,  32.2,  29.8,  29.4,  30.6,  30.2,  28.4,  28.1,  27.7,  27.4,  28.3,  28.2,  27.4,  26.9,  28.9,  26.3,  27.8,  25.8,  25.6,  25.3,  25.1,  26.2,  24.8,  24.6,  26.7,  25.0,  24.7,  26.7,  24.2,  25.7,  23.9,  23.7,  23.6,  23.5,  23.3,  23.2,  27.5,  25.9,  23.3,  24.8,  24.3,  22.7,  35.4,  40.3,  33.9,  31.7,  28.1,  29.4,  27.0,  28.2,  27.7,  27.3,  25.6,  32.0,  28.9,  25.5,  27.2,  25.0,  26.4,  26.1,  25.8,  25.6,1438.5,  28.4,  27.0,  26.3,  25.8,  25.5,  25.2,  24.9,  24.7,  52.8,  27.4,  26.1,  23.5,  25.0,  24.7,  24.4,  24.2,  24.1,  27.6,  25.8,  23.0,  24.5,  24.2,  22.6,  23.8,  32.3,  25.9,  24.8,  24.2,  23.9,  23.7,  23.4,  26.0,  24.6,  23.9,  23.5,  26.7,  39.0, 214.3, 129.7, 112.0, 103.1,  97.6,  93.5,  90.7, 105.2,  91.0,  87.8,  85.7,  89.8,  85.7,  83.9,  86.0,  83.6,  85.8,  83.2,  84.9,  90.6,  83.8,  85.3,  88.3, 106.5,  84.5,  85.3,  86.0,  86.6,  87.0,  87.4,  87.7,  93.9,  91.7,  91.3,  95.9],[  47.0, 127.5, 122.3, 157.3, 104.3,  85.7,  75.4,  68.6,  63.5,  59.4,  56.2,  54.5,  51.9,  49.7,  47.9,  46.3,  44.8,  62.2,  50.2,  49.3,  47.3,  44.2,  43.0,  41.9,  40.8,  41.5,  39.9,  38.9,  38.1,  37.4,  36.7,  36.0,  35.4,  34.8,  34.3,  35.2,  33.3,  32.8,  32.3,  31.9,  31.5,  32.4,  31.5,  30.9,  30.5,  30.0,  31.5,  31.0,  28.9,  28.6,  29.8,  27.9,  27.6,  27.3,  28.2,  26.8,  27.5,  30.2,  26.6,  26.3,  26.0,  25.7,  25.5,  26.8,  25.1,  24.9,  26.0,  24.5,  25.5,  25.5,  28.2,  27.0,  24.2,  24.1,  23.9,  25.2,  23.6,  23.4,  23.3,  23.2,  24.8,  26.8,  25.6,  24.9,  24.6,  24.1,  22.6,  51.6,  32.8,  33.6,  31.4,  30.2,  29.3,  28.6,  26.4,  27.5,  25.8,  26.8,  33.2,  28.9,  27.8,  25.1,  26.7,  26.3,  24.5,  25.6,  25.4,  25.2,  28.7,  27.0,  26.2,  25.8,  25.3,  25.1,  24.8,  24.6,  24.4,  27.7,  26.1,  25.4,  25.0,  24.6,  24.4,  24.1,  23.9,  28.4,  25.8,  25.0,  24.4,  24.2,  23.9,  23.7,  23.5,  26.0,  24.8,  24.2,  23.8,  23.6,  23.2,  26.6,  24.5,  23.9,  23.4,  23.7,  24.3, 164.5, 128.1, 108.7, 100.0, 113.3,  97.4,  92.1,  88.9,  86.5,  97.3,  86.9,  84.2, 101.3,  84.5,  82.1,  85.1,  81.6,  84.4,  81.0,  82.6,  89.0,  81.1,  82.3,  84.5,  89.7,  80.9,  81.2,  81.6,  81.8,  81.8,  93.5,  86.4,  84.3,  83.4,  87.1,  84.6,  82.0,  83.8,  82.7,  87.4,  84.5],[  61.0,  62.9,  61.5,  61.3,  60.9,  60.2,  59.4,  58.3,  57.2,  56.0,  54.7,  53.4,  52.1,  50.8,  49.5,  49.3,  47.8,  46.6,  45.5,  44.4,  44.1,  53.4,  49.4,  47.2,  47.6,  44.4,  44.9,  42.2,  41.2,  40.4,  39.6,  38.8,  38.1,  38.7,  37.6,  39.8,  38.7,  37.8,  37.1,  34.4,  33.9,  33.4,  33.0,  32.5,  32.1,  33.1,  32.5,  30.9,  30.5,  37.6,  30.6,  30.1,  29.6,  31.3,  30.8,  30.3,  28.2,  27.9,  27.6,  27.3,  27.0,  28.0,  26.5,  27.4,  27.1,  26.4,  28.8,  25.8,  25.5,  25.3,  25.1,  24.9,  24.7,  24.5,  25.5,  24.1,  24.0,  34.2,  24.5,  26.8,  23.9,  23.7,  25.2,  23.4,  23.2,  24.5,  24.3,  22.9,  22.7,  23.4,  25.5,  24.8,  24.3,  22.5,  22.3,  39.4,  33.4,  35.2,  31.9,  30.2,  29.2,  28.5,  26.2,  27.3,  25.5,  26.5,  25.0,  30.2,  28.0,  27.2,  26.5,  26.1,  25.8,  25.5,  25.3,  25.0,  34.4,  27.5,  26.3,  25.7,  25.2,  24.9,  24.7,  24.4,  24.2,  33.2,  26.6,  23.1,  24.9,  24.5,  24.2,  23.9,  23.7,  23.5,  26.8,  22.7,  24.5,  24.0,  23.7,  23.5,  22.0,  29.9,  25.2,  24.3,  23.7,  23.4,  23.2,  22.9,  25.3,  23.9,  23.3,  21.6,  25.5,  35.5, 229.3, 121.5, 106.5,  98.9,  93.8,  90.2,  87.4,  92.0,  87.0,  84.3,  82.5,  85.6,  82.2, 113.0,  82.4,  79.9,  82.1,  79.3,  80.9,  90.6,  79.5,  81.2,  86.7,  78.7,  79.4,  80.1,  80.6,  81.0,  80.9,  80.5,  80.1,  79.5,  85.5,  76.8,  80.0,  82.4,  79.6,  81.5,  82.7,  83.5,  83.6,  79.4,  81.1,  84.5,  81.4,  82.0]]
num_steps = 200

max_flux = p['Phi0__pH_ns']/2
flux_resolution = max_flux/num_steps
I_drive_off = np.ceil(max_flux/flux_resolution)*flux_resolution/M
dI_drive = flux_resolution/M

#%%
rate = WRSpice.WRSpice(tempCirFile = 'dend__4jj__cnst_drv', OutDatFile = 'dend_{:d}jj_cnst_drv_seek_rt_arry_'.format(num_jjs)) # no file extentions
rate.pathWRSSpice = '/raid/home/local/xictools/wrspice.current/bin/wrspice'  # for running on grumpy
# rate.pathWRSSpice='C:/usr/local/xictools/wrspice/bin/wrspice.bat' # for local computer

rate.save = 'L2#branch v(12) v(5)' # list all vectors you want to save
rate.pathCir = ''

L_di = 77.5e3 # pH

FileFormat = 'Llft20pHLrgt20pH_Ide{:05.2f}uA_Idrive{:08.5f}uA_Ldi0077.5nH_Ijtl36.00uA_Isc35.00uA'
for ii in range(len(I_de_list)):
    I_drive_vec = np.arange(I_drive_on__vec[ii],I_drive_off,dI_drive)
    for jj in range(len(I_drive_vec)):
    
        print('ii = {} of {}; jj = {} of {}'.format(ii+1,len(I_de_list),jj+1,len(I_drive_vec)))
            
        FilePrefix = FileFormat.format(I_de_list[ii],I_drive_vec[jj])
        rate.FilePrefix = FilePrefix
                    
        Params = {          
        'Ide':'{:6.4f}u'.format(np.round(I_de_list[ii],4)),
        'Ia':'{:6.4f}u'.format(np.round(I_drive_vec[jj],4)),
        'Ldi':'{:6.4f}n'.format(np.round(L_di*1e-3,4))
        }
    
        rate.Params = Params
        rate.stepTran = '1p'
        _ts = '{:f}n'.format(time_off__array[ii][jj])
        rate.stopTran = _ts
        rate.doAll()
